{
  "db_name": "PostgreSQL",
  "query": "SELECT\n  json_agg(album_data) as \"items: Json<Vec<Album>>\"\n  FROM (\n    SELECT\n      release_group.gid AS Id,\n      array(\n        SELECT gid\n          FROM release_group_gid_redirect\n         WHERE release_group_gid_redirect.new_id = release_group.id\n      ) as OldIds,\n      release_group.comment AS Disambiguation,\n      release_group.name AS Title,\n      array(\n        SELECT name\n          FROM release_group_alias\n         WHERE release_group_alias.release_group = release_group.id\n           AND (release_group_alias.type is NULL OR release_group_alias.type = 1)\n\n        UNION\n\n        SELECT release.name\n          FROM release\n         WHERE release.release_group = release_group.id\n           AND release.name != release_group.name\n      ) as Aliases,\n      COALESCE(release_group_primary_type.name, 'Other') AS Type,\n      array(\n        SELECT name\n          FROM release_group_secondary_type rgst\n                 JOIN release_group_secondary_type_join rgstj ON rgstj.secondary_type = rgst.id\n         WHERE rgstj.release_group = release_group.id\n         ORDER BY name ASC\n      ) AS SecondaryTypes,\n      COALESCE(\n        make_date(\n          release_group_meta.first_release_date_year,\n          release_group_meta.first_release_date_month,\n          release_group_meta.first_release_date_day\n        ),\n        make_date(\n          COALESCE(release_group_meta.first_release_date_year, 1),\n          COALESCE(release_group_meta.first_release_date_month, 1),\n          COALESCE(release_group_meta.first_release_date_day, 1)\n        )\n      )as ReleaseDate,\n      artist.gid AS ArtistId,\n      array(\n\tSELECT DISTINCT\n\t  artist.gid\n\t  FROM artist\n\t\t JOIN artist_credit_name on artist.id = artist_credit_name.artist\n\t\t JOIN track on track.artist_credit = artist_credit_name.artist_credit\n\t\t JOIN medium on track.medium = medium.id\n\t\t JOIN release on medium.release = release.id\n\t WHERE release.release_group = release_group.id\n\t   AND artist_credit_name.position = 0\n\n         UNION\n\n        SELECT\n          artist.gid\n          FROM artist\n                 JOIN artist_credit_name ON artist_credit_name.artist = artist.id\n         WHERE artist_credit_name.artist_credit = release_group.artist_credit\n           AND artist_credit_name.position = 0\n      ) AS ArtistIds,\n      (\n        SELECT json_agg(row_to_json(artist_data))\n        FROM (\n          SELECT\n            a.gid AS Id,\n            a.name AS Name,\n            a.sort_name AS SortName,\n            a.comment AS Disambiguation,\n            area.name AS Area\n          FROM artist a\n                 LEFT JOIN area ON a.area = area.id\n          WHERE a.gid = ANY (\n            array(\n              SELECT DISTINCT artist.gid\n                FROM artist\n                       JOIN artist_credit_name on artist.id = artist_credit_name.artist\n                       JOIN track on track.artist_credit = artist_credit_name.artist_credit\n                       JOIN medium on track.medium = medium.id\n                       JOIN release on medium.release = release.id\n               WHERE release.release_group = release_group.id\n                 AND artist_credit_name.position = 0\n\n               UNION\n\n              SELECT artist.gid\n                FROM artist\n                       JOIN artist_credit_name ON artist_credit_name.artist = artist.id\n               WHERE artist_credit_name.artist_credit = release_group.artist_credit\n                 AND artist_credit_name.position = 0\n            )\n          )\n        ) artist_data\n      ) AS Artists,\n      json_build_object(\n        'Count', COALESCE(release_group_meta.rating_count, 0),\n        'Value', release_group_meta.rating::decimal / 10\n      ) AS Rating,\n      array(\n        SELECT url.url\n          FROM url\n                 JOIN l_release_group_url ON l_release_group_url.entity0 = release_group.id AND l_release_group_url.entity1 = url.id\n      ) AS Links,\n      array(\n        SELECT INITCAP(genre.name)\n          FROM genre\n                 JOIN tag ON genre.name = tag.name\n                 JOIN release_group_tag ON release_group_tag.tag = tag.id\n         WHERE release_group_tag.release_group = release_group.id\n           AND release_group_tag.count > 0\n      ) AS Genres,\n      (\n\tSELECT\n\t  json_agg(row_to_json(images_data))\n\t  FROM (\n\t    SELECT unnest(types) AS type,\n\t\t   release.gid AS release_gid,\n\t\t   index_listing.id AS image_id\n\t      FROM cover_art_archive.index_listing\n\t\t     JOIN release ON index_listing.release = release.id\n\t     WHERE release.release_group = release_group.id\n\t     ORDER BY index_listing.ordering ASC\n\t  ) images_data\n      ) AS images,\n      (\n        SELECT\n          COALESCE(json_agg(row_to_json(releases_data)), '[]'::json)\n          FROM (\n            SELECT\n              release.gid AS Id,\n              array(\n                SELECT gid\n                  FROM release_gid_redirect\n                 WHERE release_gid_redirect.new_id = release.id\n              ) as oldids,\n              release.name AS Title,\n              release.comment AS Disambiguation,\n              release_status.name AS Status,\n              (\n                SELECT\n                  COALESCE(\n                    MIN(make_date(date_year, date_month, date_day)),\n                    MIN(make_date(COALESCE(date_year, 1), COALESCE(date_month, 1), COALESCE(date_day, 1)))\n                    )\n                  FROM (\n                    SELECT date_year, date_month, date_day\n                      FROM release_country\n                     WHERE release_country.release = release.id\n\n                     UNION\n\n                    SELECT date_year, date_month, date_day\n                      FROM release_unknown_country\n                     WHERE release_unknown_country.release = release.id\n                  ) dates\n              ) AS ReleaseDate,\n              array(\n                SELECT name FROM label\n                                   JOIN release_label ON release_label.label = label.id\n                 WHERE release_label.release = release.id\n                 ORDER BY name ASC\n              ) AS Label,\n              array(\n                SELECT name FROM area\n                                   JOIN country_area ON country_area.area = area.id\n                                   JOIN release_country ON release_country.country = country_area.area\n                 WHERE release_country.release = release.id\n              ) AS Country,\n              array(\n                SELECT json_build_object(\n                  'Format', medium_format.name,\n                  'Name', medium.name,\n                  'Position', medium.position\n                ) FROM medium\n                         JOIN medium_format ON medium_format.id = medium.format\n                 WHERE medium.release =  release.id\n                 ORDER BY medium.position\n              ) AS Media,\n              (SELECT SUM(medium.track_count) FROM medium WHERE medium.release = release.id) AS track_count,\n              (\n                SELECT\n                  COALESCE(json_agg(row_to_json(track_data)), '[]'::json)\n                  FROM (\n                    SELECT\n                      track.gid AS Id,\n                      array(\n                        SELECT gid\n                          FROM track_gid_redirect\n                         WHERE track_gid_redirect.new_id = track.id\n                      ) as oldids,\n                      recording.gid AS RecordingId,\n                      array(\n                        SELECT gid\n                          FROM recording_gid_redirect\n                         WHERE recording_gid_redirect.new_id = recording.id\n                      ) as OldRecordingIds,\n                      artist.gid AS ArtistId,\n                      track.name AS TrackName,\n                      track.length AS DurationMs,\n                      medium.position AS MediumNumber,\n                      track.number AS TrackNumber,\n                      track.position AS TrackPosition\n                      FROM track\n                             JOIN medium ON track.medium = medium.id\n                             JOIN artist_credit_name ON artist_credit_name.artist_credit = track.artist_credit\n                             JOIN artist ON artist_credit_name.artist = artist.id\n                             JOIN recording ON track.recording = recording.id\n                     WHERE medium.release = release.id\n                       AND artist_credit_name.position = 0\n                       AND recording.video = FALSE\n                       AND track.is_data_track = FALSE\n                  ) track_data\n              ) AS Tracks\n              FROM release\n                     JOIN release_status ON release_status.id = release.status\n             WHERE release.release_group = release_group.id\n          ) releases_data\n      ) AS Releases\n      FROM release_group\n             LEFT JOIN release_group_meta ON release_group_meta.id = release_group.id\n             LEFT JOIN release_group_primary_type ON release_group.type = release_group_primary_type.id\n             LEFT JOIN artist_credit_name ON artist_credit_name.artist_credit = release_group.artist_credit\n             LEFT JOIN artist ON artist_credit_name.artist = artist.id\n     WHERE artist_credit_name.position = 0\n     AND release_group.gid > $1\n     ORDER BY release_group.gid\n     LIMIT $2\n  ) album_data;\n",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "items: Json<Vec<Album>>",
        "type_info": "Json"
      }
    ],
    "parameters": {
      "Left": [
        "Uuid",
        "Int8"
      ]
    },
    "nullable": [
      null
    ]
  },
  "hash": "fb88890b5372c67c8b39faba32aca7a69aa00f0f8067c6743e51d9de9ca7d7d1"
}
